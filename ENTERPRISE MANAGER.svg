flowchart TD
    subgraph UserView [Unified User Interface - Single Screen]
        UI[<b>Enterprise Manager Dashboard</b><br>üìä User Chooses View: Internal / External / Combined<br>üí¨ Natural Language Queries | üîç Custom Analytics]
    end

    subgraph Factories [Factory Locations]
        subgraph F1 [Factory 1]
            F1_Systems[Factory Systems<br>MES, SCADA, IoT, Quality]
            LN1[LOCAL Node<br>Data Collector]
        end
        
        subgraph F2 [Factory 2]
            F2_Systems[Factory Systems<br>MES, SCADA, IoT, Quality]
            LN2[LOCAL Node<br>Data Collector]
        end
        
        subgraph F3 [Factory 3]
            F3_Systems[Factory Systems<br>MES, SCADA, IoT, Quality]
            LN3[LOCAL Node<br>Data Collector]
        end
    end

    subgraph HeadOffice [Company X Head Office]
        EM[<b>Enterprise Manager</b><br>Primary: Internal Optimization<br>Secondary: External Context]
        HO_Systems[Head Office Systems<br>ERP, CRM, HRMS, BI]
    end

    subgraph External [External Context Sources]
        Market[Market Trends]
        Weather[Weather Data]
        News[News & Events]
        Regulatory[Regulatory Updates]
    end

    %% Primary Internal Data Flows (Solid Lines)
    F1_Systems --> LN1
    F2_Systems --> LN2
    F3_Systems --> LN3
    
    LN1 -- "All Factory Data" --> EM
    LN2 -- "All Factory Data" --> EM
    LN3 -- "All Factory Data" --> EM
    
    HO_Systems -- "Enterprise Data" --> EM

    %% Secondary External Flow (Dashed Line)
    External -. "Contextual Support" .-> EM

    %% User Interface - Flexible Access
    EM -- "Unified Insights & Solutions<br>Internal + External Data as User Chooses" --> UI
    UI -- "User Queries & Filters" --> EM

    %% Styling
    classDef interfaceClass fill:#e8f5e8,stroke:#333,stroke-width:3px
    classDef localClass fill:#ffd6e8,stroke:#333,stroke-width:2px
    classDef enterpriseClass fill:#d4c5f9,stroke:#333,stroke-width:3px
    classDef systemClass fill:#e6f3ff,stroke:#333,stroke-width:1px
    classDef externalClass fill:#f0f0f0,stroke:#666,stroke-width:1px,dashed

    class UI interfaceClass
    class LN1,LN2,LN3 localClass
    class EM enterpriseClass
    class F1_Systems,F2_Systems,F3_Systems,HO_Systems systemClass
    class External externalClass
